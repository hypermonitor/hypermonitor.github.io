<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hypermonitor — Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Hyperliquid leaderboard dashboard" />

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="images/favicon.png" />

  <style>
    :root {
      font-family: 'Outfit', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark;
      --bg: #0b0b0f;
      --card-bg: rgba(12, 12, 16, 0.92);
      --accent: #26d97f;
      --danger: #f25f5c;
      --border: rgba(255,255,255,0.08);
      --muted: rgba(245,245,255,0.62);
      --text-main: #f5f5ff;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text-main);
    }
    #app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1.25rem;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: .55rem;
    }

    a.brand, a.brand:visited, a.brand:hover, a.brand:active {
      text-decoration: none !important;
      color: inherit;
    }

    .brand-name {
      font-family: 'Outfit', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-weight: 600;
      letter-spacing: 0.04em;
      font-size: 1.05rem;
      text-transform: uppercase;
      margin: 0;
      color: #fff;
      font-style: normal;
    }

    .brand-name .hyper,
    .brand-name em {
      font-style: inherit !important;
      font-weight: inherit !important;
    }

    .logo-dot { display: none; }

    .tagline {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: .35rem;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.1rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.45);
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      align-items: center;
      justify-content: space-between;
      margin-bottom: .85rem;
    }

    .left-tools, .right-tools {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      align-items: center;
    }

    .pill-btn, .select, .input {
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(17, 17, 17, 0.85);
      color: var(--text-main);
      font-size: 0.88rem;
      padding: 0.5rem 1rem;
      outline: none;
      transition: border-color 0.15s ease, background 0.15s ease;
    }

    .pill-btn:focus, .select:focus, .input:focus {
      border-color: rgba(255, 255, 255, 0.85);
      background: rgba(20, 20, 22, 0.9);
    }
    
    .muted { color: var(--muted); }
    .money { font-variant-numeric: tabular-nums; }

    .leaderboard-table-wrap {
      max-height: 70vh;
      overflow: auto;
      border-radius: .75rem;
      border: 1px solid var(--border);
      position: relative;
    }
    .leaderboard-table-wrap.loading {
      --pulse-size: 220px;
      background-image: url("images/pulse.gif");
      background-repeat: no-repeat;
      background-position: center 45%;
      background-size: var(--pulse-size) auto;
    }
    .leaderboard-table-wrap.loading td {
      color: var(--muted);
    }
    .loading-overlay {
      position: absolute;
      left: 50%;
      top: calc(45% + (var(--pulse-size) * 0.35));
      transform: translate(-50%, -50%);
      color: var(--muted);
      font-size: 0.9rem;
      pointer-events: none;
      display: none;
    }
    .leaderboard-table-wrap.loading .loading-overlay {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    thead {
      background: var(--card-bg);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    th, td {
      padding: 0.45rem 0.5rem;
      text-align: left;
      border-bottom: none;
      white-space: nowrap;
    }
    tbody tr:nth-child(even) { background: transparent; }

    th.sortable { cursor: pointer; }
    th.sortable:hover { color: #97fde5; }

    .row-link {
      cursor: pointer;
    }
    .row-link:hover {
      background: rgba(255, 255, 255, 0.08) !important;
    }

    .addr {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: 0.3rem 0.7rem;
      border-radius: 9999px;
      font-size: 0.78rem;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(17, 17, 17, 0.85);
      color: var(--text-main);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
    }

    .dot {
      width: 0.55rem;
      height: 0.55rem;
      border-radius: 999px;
      background: #fbbf24;
      box-shadow: 0 0 4px rgba(251, 191, 36, 0.6);
    }
    .dot.ok { background: var(--accent); box-shadow: 0 0 6px rgba(34, 197, 94, 0.7); }
    .dot.err { background: var(--danger); box-shadow: 0 0 6px rgba(248, 113, 113, 0.7); }

    .footer-note { margin-top: .75rem; font-size: .78rem; color: var(--muted); }

    /* Footer (from track.html) */
    footer {
      margin-top: 0.2rem;
      padding: 0.2rem 0 0;
      border-top: 1px #262637;
      color: #a1a1b5;
      font-size: .78rem;
      line-height: 1.45;
    }

    footer a {
      color: var(--muted);
      text-decoration: none;
      padding: 0;
      border: none;
      background: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    footer a:hover {
      color: inherit;
      text-decoration: underline;
    }

    @media (max-width: 700px) {
      #app { padding: 0.9rem; }
      th, td { padding: 0.35rem 0.4rem; }
      table { font-size: 0.75rem; }
      .hide-mobile { display: none; }
    }

    @media (max-width: 768px) {
      .leaderboard-table-wrap {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      table {
        font-size: 0.78rem;
      }

      th,
      td {
        padding: 0.35rem 0.4rem;
      }

      th:first-child,
      td:first-child {
        width: 2.2rem;
      }

      th:nth-child(3),
      td:nth-child(3),
      th:nth-child(4),
      td:nth-child(4),
      th:nth-child(6),
      td:nth-child(6) {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div id="app">
    <header>
      <div>
        <a class="brand" href="/" aria-label="Hypermonitor home">
          <img src="images/logo.png" alt="Hypermonitor logo" style="width: 2.8rem; height: auto; border-radius: 4px;" />
          <h1 class="brand-name"><span class="hyper">Hyper</span><em>monitor</em></h1>
        </a>
        <div class="tagline">Live leaderboard. Tap a row to open the wallet.</div>
      </div>

      <div class="status" id="statusPill">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">Idle</span>
      </div>
    </header>

    <section class="card">
      <div class="toolbar">
        <div class="left-tools">
          <select id="windowSelect" class="select" title="Performance window">
            <option value="day">Day</option>
            <option value="week">Week</option>
            <option value="month">Month</option>
            <option value="allTime" selected>All Time</option>
          </select>

          <input id="searchInput" class="input" style="min-width: 420px;"
                 placeholder="Search address (0x…), or filter…" autocomplete="off" />

          <select id="limitSelect" class="select" title="Rows to show">
            <option value="100" selected>Top 100</option>
            <option value="1000">Top 1000</option>
            <option value="10000">Top 10000</option>
            <option value="100000">All</option>
          </select>
        </div>
      </div>

      <div class="leaderboard-table-wrap loading" id="tableWrap">
        <div class="loading-overlay" id="loadingOverlay">Loading…</div>
        <table>
          <thead>
            <tr>
              <th class="sortable" data-key="rank">#</th>
              <th>Trader</th>
              <th class="sortable" data-key="accountValue">Account Value</th>
              <th class="sortable" data-key="pnl">PnL</th>
              <th class="sortable" data-key="roi">ROI</th>
              <th class="sortable hide-mobile" data-key="volume">Volume</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
            <tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer>
      <div style="margin-top:.1rem;">
        © <span id="year"></span> <a href="/">Hypermonitor</a>.
      </div>
    </footer>
  </div>

  <script>
    // ===== CONFIG =====
    const LEADERBOARD_URL = "https://stats-data.hyperliquid.xyz/Mainnet/leaderboard";
    const DEST_BASE = "https://www.hypermonitor.org/track?wallet="; // you asked for this exact format

    // ===== DOM =====
    const tbody = document.getElementById("tbody");
    const searchInput = document.getElementById("searchInput");
    const limitSelect = document.getElementById("limitSelect");
    const windowSelect = document.getElementById("windowSelect");
    const tableWrap = document.getElementById("tableWrap");

    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");

    // ===== STATE =====
    let rawRows = [];
    let viewRows = [];
    let sortKey = "rank";
    let sortDir = "asc";

    function setStatus(kind, msg) {
      statusDot.classList.remove("ok", "err");
      if (kind === "ok") statusDot.classList.add("ok");
      if (kind === "err") statusDot.classList.add("err");
      statusText.textContent = msg || "";
    }

    function renderLoadingRows(count = 20) {
      const rows = Array.from({ length: count }, () => (
        `<tr><td class="money">&nbsp;</td><td class="addr">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money">&nbsp;</td><td class="money hide-mobile">&nbsp;</td></tr>`
      )).join("");
      tbody.innerHTML = rows;
    }

    function setLoadingState(isLoading) {
      if (tableWrap) tableWrap.classList.toggle("loading", isLoading);
      if (isLoading) renderLoadingRows();
    }

    function fmtMoney(v, decimals = 2) {
      const n = Number(v);
      if (!Number.isFinite(n)) return "";
      const sign = n < 0 ? "-" : "";
      const abs = Math.abs(n).toLocaleString(undefined, { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
      return `${sign}$${abs}`;
    }

    function fmtPct(v) {
      const n = Number(v);
      if (!Number.isFinite(n)) return "";
      const sign = n < 0 ? "-" : "";
      const abs = Math.abs(n * 100).toLocaleString(undefined, { maximumFractionDigits: 2 });
      return `${sign}${abs}%`;
    }

    function shortAddr(a) {
      if (!a || typeof a !== "string") return "";
      if (a.length <= 12) return a;
      return a.slice(0, 6) + "…" + a.slice(-4);
    }

    // windowPerformances often looks like: [["day", {...}], ["week", {...}], ...]
    function perfForWindow(row, windowKey) {
      const wp = row?.windowPerformances;
      if (!Array.isArray(wp)) return null;
      for (const entry of wp) {
        if (Array.isArray(entry) && entry[0] === windowKey) return entry[1] || null;
      }
      return null;
    }

    function normalize(rows) {
      const windowKey = windowSelect.value || "allTime";

      return (rows || []).map((r, idx) => {
        const address =
          r?.ethAddress ||
          r?.address ||
          r?.user ||
          r?.wallet ||
          "";

        const accountValue = Number(r?.accountValue ?? r?.account_value ?? NaN);

        const p = perfForWindow(r, windowKey) || {};
        const pnl = Number(p?.pnl ?? p?.pnlUsd ?? p?.pnl_usd ?? NaN);
        const roi = Number(p?.roi ?? p?.return ?? NaN);
        const volume = Number(p?.vlm ?? p?.vol ?? p?.tradeVolume ?? NaN);

        return {
          rank: idx + 1,
          address,
          accountValue,
          pnl,
          roi,
          volume,
        };
      });
    }

    function applyFiltersAndSort() {
      const q = (searchInput.value || "").trim().toLowerCase();
      const lim = Number(limitSelect.value || 100);

      let rows = viewRows.slice();

      if (q) {
        rows = rows.filter(r => (r.address || "").toLowerCase().includes(q));
      }

      rows.sort((a, b) => {
        const va = a?.[sortKey];
        const vb = b?.[sortKey];

        // rank always numeric
        const na = Number(va);
        const nb = Number(vb);

        const aValid = Number.isFinite(na);
        const bValid = Number.isFinite(nb);

        // push NaNs to bottom
        if (!aValid && !bValid) return 0;
        if (!aValid) return 1;
        if (!bValid) return -1;

        return sortDir === "asc" ? (na - nb) : (nb - na);
      });

      rows = rows.slice(0, lim);
      render(rows);
    }

    function render(rows) {
      if (!rows.length) {
        tbody.innerHTML = `<tr><td colspan="6" class="muted">No results.</td></tr>`;
        return;
      }

      tbody.innerHTML = rows.map(r => {
        const addr = r.address || "";
        const href = DEST_BASE + encodeURIComponent(addr);

        const pnlColor = Number.isFinite(r.pnl) ? (r.pnl >= 0 ? "#4ade80" : "#fb7185") : "inherit";
        const roiColor = Number.isFinite(r.roi) ? (r.roi >= 0 ? "#4ade80" : "#fb7185") : "inherit";

        return `
          <tr class="row-link" data-href="${href}" title="Open ${addr}">
            <td class="money">${r.rank}</td>
            <td class="addr">${shortAddr(addr)}</td>
            <td class="money">${fmtMoney(r.accountValue)}</td>
            <td class="money" style="color:${pnlColor};">${Number.isFinite(r.pnl) ? fmtMoney(r.pnl) : ""}</td>
            <td class="money" style="color:${roiColor};">${Number.isFinite(r.roi) ? fmtPct(r.roi) : ""}</td>
            <td class="money hide-mobile">${Number.isFinite(r.volume) ? fmtMoney(r.volume, 0) : ""}</td>
          </tr>
        `;
      }).join("");

      // row click -> go to your wallet page
      tbody.querySelectorAll("tr[data-href]").forEach(tr => {
        tr.addEventListener("click", () => {
          const href = tr.getAttribute("data-href");
          if (href) window.location.href = href;
        });
      });
    }

    async function loadLeaderboard() {
        setStatus("", "Loading…");
        setLoadingState(true);

        try {
            const res = await fetch(LEADERBOARD_URL, { cache: "no-store" });

            const rawText = await res.text();
            if (!res.ok) {
            throw new Error(`HTTP ${res.status} ${res.statusText} — ${rawText.slice(0, 160)}`);
            }

            let json;
            try {
            json = JSON.parse(rawText);
            } catch {
            // Not JSON at all (often HTML from an edge/CORS block)
            throw new Error(`Non-JSON response: ${rawText.slice(0, 160)}`);
            }

            // ✅ Accept multiple response shapes
            let rows = null;

            if (Array.isArray(json)) {
            rows = json;
            } else if (json && typeof json === "object") {
            if (Array.isArray(json.data)) rows = json.data;
            else if (Array.isArray(json.leaderboard)) rows = json.leaderboard;
            else if (Array.isArray(json.leaderboardRows)) rows = json.leaderboardRows; // ✅ YOUR CASE
            else if (json.result && Array.isArray(json.result)) rows = json.result;
            else if (json.payload && Array.isArray(json.payload)) rows = json.payload;

            if (!rows && (json.error || json.message)) {
                throw new Error(String(json.error || json.message));
            }
            }

            if (!rows) {
            const keys = json && typeof json === "object" ? Object.keys(json).join(", ") : typeof json;
            throw new Error(`Unexpected response shape. Top-level keys/type: ${keys}`);
            }

            rawRows = rows;
            viewRows = normalize(rawRows);
            setStatus("ok", `Loaded ${rawRows.length} wallets`);
            setLoadingState(false);
            applyFiltersAndSort();
        } catch (e) {
            console.error("Leaderboard load failed:", e);
            setStatus("err", "Failed to load leaderboard");
            setLoadingState(false);
            tbody.innerHTML = `<tr><td colspan="6" class="muted">Failed to load leaderboard. ${String(e?.message || e)}</td></tr>`;
        }
        }

    // ===== EVENTS =====
    searchInput.addEventListener("input", () => applyFiltersAndSort());
    limitSelect.addEventListener("change", () => applyFiltersAndSort());

    windowSelect.addEventListener("change", () => {
      // re-normalize because the chosen window changes which PnL/ROI/Volume fields we display
      viewRows = normalize(rawRows);
      applyFiltersAndSort();
    });

    document.querySelectorAll("th.sortable").forEach(th => {
      th.addEventListener("click", () => {
        const key = th.getAttribute("data-key");
        if (!key) return;
        if (sortKey === key) sortDir = (sortDir === "asc" ? "desc" : "asc");
        else { sortKey = key; sortDir = "asc"; }
        applyFiltersAndSort();
      });
    });

    // Footer year
    const yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    // ===== BOOT =====
    loadLeaderboard();
  </script>
</body>
</html>
